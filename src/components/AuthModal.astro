---
// Componente de Modal de Autenticación para Sensus
---

<!-- Modal de Autenticación -->
<div id="auth-modal" class="auth-modal">
  <div class="auth-modal-content">
    <!-- Header del Modal -->
    <div class="auth-modal-header">
      <button class="auth-modal-close" onclick="closeAuthModal()">
        <i class="fas fa-times"></i>
      </button>
      
      <div class="auth-modal-logo">
        <i class="fas fa-heart"></i>
      </div>
      
      <h2 class="auth-modal-title">Bienvenido a Sensus</h2>
      <p class="auth-modal-subtitle">Tu compañero para el bienestar mental</p>
    </div>

    <!-- Tabs de Autenticación -->
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchAuthTab('login')">
        Iniciar Sesión
      </button>
      <button class="auth-tab" onclick="switchAuthTab('register')">
        Registrarse
      </button>
    </div>

    <!-- Formulario de Inicio de Sesión -->
    <form id="login-form" class="auth-form active">
      <div class="auth-form-group">
        <label for="login-email" class="auth-form-label required">Correo electrónico</label>
        <input 
          type="email" 
          id="login-email" 
          class="auth-form-input" 
          placeholder="tu@email.com"
          required
        >
      </div>

      <div class="auth-form-group">
        <label for="login-password" class="auth-form-label required">Contraseña</label>
        <input 
          type="password" 
          id="login-password" 
          class="auth-form-input" 
          placeholder="Tu contraseña"
          required
        >
      </div>

      <div class="auth-form-checkbox-group">
        <input type="checkbox" id="remember-me" class="auth-form-checkbox">
        <label for="remember-me" class="auth-form-checkbox-label">
          Recordarme
        </label>
      </div>

      <button type="submit" class="auth-form-submit auth-submit">
        <i class="fas fa-sign-in-alt"></i>
        Iniciar Sesión
      </button>

      <!-- Botones Sociales -->
      <div class="auth-social-buttons">
        <div class="auth-social-divider">
          <span>O continúa con</span>
        </div>
        
        <button type="button" class="auth-social-btn google" onclick="signInWithGoogle()">
          <i class="fab fa-google"></i>
          Google
        </button>
        
        <button type="button" class="auth-social-btn apple" onclick="signInWithApple()">
          <i class="fab fa-apple"></i>
          Apple
        </button>
      </div>

      <!-- Enlaces adicionales -->
      <div class="auth-form-links">
        <a href="#" class="auth-form-link forgot-password" onclick="showPasswordResetModal()">
          ¿Olvidaste tu contraseña?
        </a>
        <p>
          ¿No tienes cuenta? 
          <a href="#" class="auth-form-link" onclick="switchAuthTab('register')">
            Regístrate aquí
          </a>
        </p>
      </div>
    </form>

    <!-- Formulario de Registro -->
    <form id="register-form" class="auth-form">
      <div class="auth-form-group double">
        <div>
          <label for="register-first-name" class="auth-form-label required">Nombre</label>
          <input 
            type="text" 
            id="register-first-name" 
            class="auth-form-input" 
            placeholder="Tu nombre"
            required
          >
        </div>
        <div>
          <label for="register-last-name" class="auth-form-label required">Apellido</label>
          <input 
            type="text" 
            id="register-last-name" 
            class="auth-form-input" 
            placeholder="Tu apellido"
            required
          >
        </div>
      </div>

      <div class="auth-form-group">
        <label for="register-email" class="auth-form-label required">Correo electrónico</label>
        <input 
          type="email" 
          id="register-email" 
          class="auth-form-input" 
          placeholder="tu@email.com"
          required
        >
      </div>

      <div class="auth-form-group">
        <label for="register-birth-date" class="auth-form-label required">Fecha de nacimiento</label>
        <input 
          type="date" 
          id="register-birth-date" 
          class="auth-form-input" 
          required
        >
      </div>

      <div class="auth-form-group">
        <label for="register-password" class="auth-form-label required">Contraseña</label>
        <input 
          type="password" 
          id="register-password" 
          class="auth-form-input" 
          placeholder="Mínimo 8 caracteres"
          required
        >
      </div>

      <div class="auth-form-group">
        <label for="register-confirm-password" class="auth-form-label required">Confirmar contraseña</label>
        <input 
          type="password" 
          id="register-confirm-password" 
          class="auth-form-input" 
          placeholder="Repite tu contraseña"
          required
        >
      </div>

      <div class="auth-form-checkbox-group">
        <input type="checkbox" id="accept-terms" class="auth-form-checkbox" required>
        <label for="accept-terms" class="auth-form-checkbox-label">
          Acepto los <a href="/terminos-uso" class="auth-form-link">términos y condiciones</a>
        </label>
      </div>

      <div class="auth-form-checkbox-group">
        <input type="checkbox" id="newsletter" class="auth-form-checkbox">
        <label for="newsletter" class="auth-form-checkbox-label">
          Quiero recibir consejos de bienestar por email
        </label>
      </div>

      <button type="submit" class="auth-form-submit auth-submit">
        <i class="fas fa-user-plus"></i>
        Crear Cuenta
      </button>

      <!-- Botones Sociales -->
      <div class="auth-social-buttons">
        <div class="auth-social-divider">
          <span>O regístrate con</span>
        </div>
        
        <button type="button" class="auth-social-btn google" onclick="signInWithGoogle()">
          <i class="fab fa-google"></i>
          Google
        </button>
        
        <button type="button" class="auth-social-btn apple" onclick="signInWithApple()">
          <i class="fab fa-apple"></i>
          Apple
        </button>
      </div>

      <!-- Enlaces adicionales -->
      <div class="auth-form-links">
        <p>
          ¿Ya tienes cuenta? 
          <a href="#" class="auth-form-link" onclick="switchAuthTab('login')">
            Inicia sesión aquí
          </a>
        </p>
      </div>
    </form>
  </div>
</div>

<script>
// Funciones del modal de autenticación
function openAuthModal(tab = 'login') {
  const modal = document.getElementById('auth-modal');
  if (modal) {
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    switchAuthTab(tab);
  }
}

function closeAuthModal() {
  const modal = document.getElementById('auth-modal');
  if (modal) {
    modal.classList.remove('active');
    document.body.style.overflow = '';
    // Limpiar formularios
    clearAuthForms();
  }
}

function switchAuthTab(tab) {
  // Actualizar tabs
  const tabs = document.querySelectorAll('.auth-tab');
  tabs.forEach(t => t.classList.remove('active'));
  
  const activeTab = document.querySelector(`.auth-tab[onclick*="${tab}"]`);
  if (activeTab) {
    activeTab.classList.add('active');
  }
  
  // Actualizar formularios
  const forms = document.querySelectorAll('.auth-form');
  forms.forEach(f => f.classList.remove('active'));
  
  const activeForm = document.getElementById(`${tab}-form`);
  if (activeForm) {
    activeForm.classList.add('active');
  }
}

function clearAuthForms() {
  const forms = document.querySelectorAll('.auth-form');
  forms.forEach(form => {
    form.reset();
    // Limpiar mensajes de error
    const messages = form.querySelectorAll('.auth-form-message');
    messages.forEach(msg => msg.remove());
    // Limpiar clases de error
    const inputs = form.querySelectorAll('.auth-form-input');
    inputs.forEach(input => input.classList.remove('error'));
  });
}

function showAuthMessage(form, message, type = 'error') {
  const messageDiv = document.createElement('div');
  messageDiv.className = `auth-form-message ${type}`;
  
  const icon = type === 'error' ? 'exclamation-circle' : 
               type === 'success' ? 'check-circle' : 'info-circle';
  
  messageDiv.innerHTML = `
    <i class="fas fa-${icon}"></i>
    ${message}
  `;
  
  form.insertBefore(messageDiv, form.firstChild);
  
  // Remover mensaje después de 5 segundos
  setTimeout(() => {
    if (messageDiv.parentNode) {
      messageDiv.remove();
    }
  }, 5000);
}

function showAuthLoading(form, show = true) {
  const submitBtn = form.querySelector('.auth-submit');
  if (submitBtn) {
    if (show) {
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <div class="auth-form-loading">
          <div class="spinner"></div>
          Procesando...
        </div>
      `;
    } else {
      submitBtn.disabled = false;
      // Restaurar texto original según el formulario
      if (form.id === 'login-form') {
        submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Iniciar Sesión';
      } else if (form.id === 'register-form') {
        submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> Crear Cuenta';
      }
    }
  }
}

// Cerrar modal al hacer clic fuera
document.addEventListener('click', function(event) {
  const modal = document.getElementById('auth-modal');
  if (modal && event.target === modal) {
    closeAuthModal();
  }
});

// Cerrar modal con Escape
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    const modal = document.getElementById('auth-modal');
    if (modal && modal.classList.contains('active')) {
      closeAuthModal();
    }
  }
});

// Exportar funciones globalmente
window.openAuthModal = openAuthModal;
window.closeAuthModal = closeAuthModal;
window.switchAuthTab = switchAuthTab;
window.showAuthMessage = showAuthMessage;
window.showAuthLoading = showAuthLoading;
</script>
