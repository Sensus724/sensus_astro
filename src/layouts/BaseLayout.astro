---
import PWAInstaller from '../components/PWAInstaller.astro';
import OfflineHandler from '../components/OfflineHandler.astro';
import ThemeToggle from '../components/ThemeToggle.astro';

export interface Props {
  title: string
  description?: string
  keywords?: string
  pageStylesheets?: string[]
  themeColor?: string
  activeNav?: string
}

const {
  title,
  description = "Tu compañero inteligente para la calma. Test GAD-7 gratuito, diario emocional encriptado y recursos profesionales. Validado por más de 127,000 personas en estudios clínicos.",
  keywords = "ansiedad, test ansiedad, diario emocional, salud mental, app ansiedad, test GAD-7, control ansiedad, bienestar mental, terapia online, mindfulness",
  pageStylesheets = [],
  themeColor = "#2563EB",
  activeNav = ""
} = Astro.props
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    
    <!-- CSS Principal Optimizado -->
    <style is:global>
        @import "/src/styles/main.css";
        @import "/src/styles/notifications.css";
    </style>
    
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/src/styles/themes/theme-variables.css">
    
    <!-- Meta tags -->
    <meta name="description" content={description}>
    <meta name="keywords" content={keywords}>
    <meta name="author" content="Sensus Team">
    
    <!-- SEO Mejorado -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="bingbot" content="index, follow">
    <link rel="canonical" href="https://sensus.app{import.meta.env.BASE_URL}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sensus.app{import.meta.env.BASE_URL}">
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:image" content="https://sensus.app/assets/images/Logo.jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Sensus">
    <meta property="og:locale" content="es_ES">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://sensus.app{import.meta.env.BASE_URL}">
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content={description}>
    <meta name="twitter:image" content="https://sensus.app/assets/images/Logo.jpeg">
    <meta name="twitter:creator" content="@sensus_app">
    <meta name="twitter:site" content="@sensus_app">
    
    <!-- Mobile App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sensus">
    <meta name="application-name" content="Sensus">
    
    <!-- Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    
    <!-- Preload crítico -->
    <link rel="preload" href="/src/styles/main.css" as="style">
    <link rel="preload" href="/src/js/core/core.js" as="script">
    <link rel="preload" href="/src/js/modules/auth-enhanced.js" as="script">
    
    <!-- Favicon -->
    <link rel="icon" href="/assets/images/Logo.jpeg" type="image/jpeg">
    <link rel="apple-touch-icon" href="/assets/images/Logo.jpeg">
    <meta name="theme-color" content={themeColor}>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sensus">
    <meta name="application-name" content="Sensus">
    <meta name="msapplication-TileColor" content={themeColor}>
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Sensus",
      "description": "Tu compañero inteligente para la calma. Test GAD-7 gratuito, diario emocional encriptado y recursos profesionales respaldados por la ciencia.",
      "url": "https://sensus.app",
      "applicationCategory": "HealthApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "EUR"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "127000"
      },
      "author": {
        "@type": "Organization",
        "name": "Sensus Team"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Sensus",
        "logo": {
          "@type": "ImageObject",
          "url": "https://sensus.app/assets/images/Logo.jpeg"
        }
      }
    }
    </script>
</head>
<body>
    <!-- Animación de carga -->
    <div class="loading-heart">
        <i class="fas fa-heart"></i>
    </div>
    
        <!-- Header -->
        <header class="header header-peace">
        <div class="header-container">
            <!-- Logo y menú hamburguesa juntos -->
            <div class="logo-nav-container">
                <div class="logo-placeholder">
                    <i class="fas fa-brain"></i>
                    <span>SENSUS</span>
                </div>
                <button class="menu-toggle" aria-label="Abrir menú">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
            
                <!-- Navegación desktop (oculta en móvil) -->
                <nav class="main-nav nav-peace">
                <ul class="nav-links">
                    <li><a href="/" class={activeNav === "inicio" ? "active" : ""}>
                        <i class="fas fa-home" aria-hidden="true"></i>
                        Inicio
                    </a></li>
                    <li><a href="/evaluacion" class={activeNav === "evaluacion" ? "active" : ""}>
                        <i class="fas fa-clipboard-check" aria-hidden="true"></i>
                        Evaluación
                    </a></li>
                    <li><a href="/diario" class={activeNav === "diario" ? "active" : ""}>
                        <i class="fas fa-book-open" aria-hidden="true"></i>
                        Diario
                    </a></li>
                    <li><a href="/ansiedad" class={activeNav === "ansiedad" ? "active" : ""}>
                        <i class="fas fa-heart" aria-hidden="true"></i>
                        Síntomas
                    </a></li>
                    <li><a href="/planes" class={activeNav === "planes" ? "active" : ""}>
                        <i class="fas fa-star" aria-hidden="true"></i>
                        Planes
                    </a></li>
                    <li><a href="/equipo" class={activeNav === "equipo" ? "active" : ""}>
                        <i class="fas fa-users" aria-hidden="true"></i>
                        Equipo
                    </a></li>
                    <li><a href="/contacto" class={activeNav === "contacto" ? "active" : ""}>
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                        Contacto
                    </a></li>
                </ul>
            </nav>
            
                    <!-- Botones de autenticación y toggle de tema -->
                    <div class="auth-buttons">
                        <ThemeToggle size="medium" variant="default" />
                        <button class="btn-cta btn-outline" data-auth="login">Iniciar sesión</button>
                        <button class="btn-cta" data-auth="register">Registrarse</button>
                    </div>
        </div>
    </header>
    
    <!-- Menu Overlay -->
    <div class="menu-backdrop"></div>
    <div class="menu-overlay">
        <div class="menu-header">
            <h3>Menú</h3>
        </div>
        <ul class="nav-links">
            <li><a href="/" class={activeNav === "inicio" ? "active" : ""}>
                <i class="fas fa-home" aria-hidden="true"></i>
                Inicio
            </a></li>
            <li><a href="/evaluacion" class={activeNav === "evaluacion" ? "active" : ""}>
                <i class="fas fa-clipboard-check" aria-hidden="true"></i>
                Evaluación
            </a></li>
            <li><a href="/diario" class={activeNav === "diario" ? "active" : ""}>
                <i class="fas fa-book-open" aria-hidden="true"></i>
                Diario
            </a></li>
            <li><a href="/ansiedad" class={activeNav === "ansiedad" ? "active" : ""}>
                <i class="fas fa-heart" aria-hidden="true"></i>
                Síntomas
            </a></li>
            <li><a href="/planes" class={activeNav === "planes" ? "active" : ""}>
                <i class="fas fa-star" aria-hidden="true"></i>
                Planes
            </a></li>
            <li><a href="/equipo" class={activeNav === "equipo" ? "active" : ""}>
                <i class="fas fa-users" aria-hidden="true"></i>
                Equipo
            </a></li>
            <li><a href="/contacto" class={activeNav === "contacto" ? "active" : ""}>
                <i class="fas fa-envelope" aria-hidden="true"></i>
                Contacto
            </a></li>
        </ul>
        
                <!-- Botones de autenticación en el menú móvil -->
                <div class="menu-auth-buttons">
                    <div class="mobile-theme-toggle">
                        <span class="theme-label">Tema:</span>
                        <ThemeToggle size="small" variant="minimal" />
                    </div>
                    <button class="btn-cta btn-outline" data-auth="login">
                        <i class="fas fa-sign-in-alt"></i>
                        Iniciar sesión
                    </button>
                    <button class="btn-cta" data-auth="register">
                        <i class="fas fa-user-plus"></i>
                        Registrarse
                    </button>
                </div>
    </div>

    <main>
        <slot />
    </main>

    <!-- PWA Components -->
    <PWAInstaller />
    <OfflineHandler />

    <!-- Modal de Autenticación -->
    <div id="auth-modal" class="auth-modal">
      <div class="auth-modal-content">
        <!-- Header del Modal -->
        <div class="auth-modal-header">
          <button class="auth-modal-close" onclick="closeAuthModal()">
            <i class="fas fa-times"></i>
          </button>
          
          <div class="auth-modal-logo">
            <i class="fas fa-heart"></i>
          </div>
          
          <h2 class="auth-modal-title">Bienvenido a Sensus</h2>
          <p class="auth-modal-subtitle">Tu compañero para el bienestar mental</p>
        </div>

        <!-- Tabs de Autenticación -->
        <div class="auth-tabs">
          <button class="auth-tab active" onclick="switchAuthTab('login')">
            Iniciar Sesión
          </button>
          <button class="auth-tab" onclick="switchAuthTab('register')">
            Registrarse
          </button>
        </div>

        <!-- Formulario de Inicio de Sesión -->
        <form id="login-form" class="auth-form active">
          <div class="auth-form-group">
            <label for="login-email" class="auth-form-label required">Correo electrónico</label>
            <input 
              type="email" 
              id="login-email" 
              name="email"
              class="auth-form-input" 
              placeholder="tu@email.com"
              required
            >
          </div>

          <div class="auth-form-group">
            <label for="login-password" class="auth-form-label required">Contraseña</label>
            <input 
              type="password" 
              id="login-password" 
              name="password"
              class="auth-form-input" 
              placeholder="Tu contraseña"
              required
            >
          </div>

          <div class="auth-form-checkbox-group">
            <input type="checkbox" id="remember-me" class="auth-form-checkbox">
            <label for="remember-me" class="auth-form-checkbox-label">
              Recordarme
            </label>
          </div>

          <button type="submit" class="auth-form-submit auth-submit">
            <i class="fas fa-sign-in-alt"></i>
            Iniciar Sesión
          </button>

          <!-- Botones Sociales -->
          <div class="auth-social-buttons">
            <div class="auth-social-divider">
              <span>O continúa con</span>
            </div>
            
            <button type="button" class="auth-social-btn google" onclick="signInWithGoogle()">
              <i class="fab fa-google"></i>
              Google
            </button>
            
            <button type="button" class="auth-social-btn apple" onclick="signInWithApple()">
              <i class="fab fa-apple"></i>
              Apple
            </button>
          </div>

          <!-- Enlaces adicionales -->
          <div class="auth-form-links">
            <a href="#" class="auth-form-link forgot-password" onclick="showPasswordResetModal()">
              ¿Olvidaste tu contraseña?
            </a>
            <p>
              ¿No tienes cuenta? 
              <a href="#" class="auth-form-link" onclick="switchAuthTab('register')">
                Regístrate aquí
              </a>
            </p>
          </div>
        </form>

        <!-- Formulario de Registro -->
        <form id="register-form" class="auth-form">
          <div class="auth-form-group double">
            <div>
              <label for="register-first-name" class="auth-form-label required">Nombre</label>
              <input 
                type="text" 
                id="register-first-name" 
                name="firstName"
                class="auth-form-input" 
                placeholder="Tu nombre"
                required
              >
            </div>
            <div>
              <label for="register-last-name" class="auth-form-label required">Apellido</label>
              <input 
                type="text" 
                id="register-last-name" 
                name="lastName"
                class="auth-form-input" 
                placeholder="Tu apellido"
                required
              >
            </div>
          </div>

          <div class="auth-form-group">
            <label for="register-email" class="auth-form-label required">Correo electrónico</label>
            <input 
              type="email" 
              id="register-email" 
              name="email"
              class="auth-form-input" 
              placeholder="tu@email.com"
              required
            >
          </div>

          <div class="auth-form-group">
            <label for="register-birth-date" class="auth-form-label required">Fecha de nacimiento</label>
            <input 
              type="date" 
              id="register-birth-date" 
              name="birthDate"
              class="auth-form-input" 
              required
            >
          </div>

          <div class="auth-form-group">
            <label for="register-password" class="auth-form-label required">Contraseña</label>
            <input 
              type="password" 
              id="register-password" 
              name="password"
              class="auth-form-input" 
              placeholder="Mínimo 8 caracteres"
              required
            >
          </div>

          <div class="auth-form-group">
            <label for="register-confirm-password" class="auth-form-label required">Confirmar contraseña</label>
            <input 
              type="password" 
              id="register-confirm-password" 
              name="confirmPassword"
              class="auth-form-input" 
              placeholder="Repite tu contraseña"
              required
            >
          </div>

          <div class="auth-form-checkbox-group">
            <input type="checkbox" id="accept-terms" class="auth-form-checkbox" required>
            <label for="accept-terms" class="auth-form-checkbox-label">
              Acepto los <a href="/terminos-uso" class="auth-form-link">términos y condiciones</a>
            </label>
          </div>

          <div class="auth-form-checkbox-group">
            <input type="checkbox" id="newsletter" class="auth-form-checkbox">
            <label for="newsletter" class="auth-form-checkbox-label">
              Quiero recibir consejos de bienestar por email
            </label>
          </div>

          <button type="submit" class="auth-form-submit auth-submit">
            <i class="fas fa-user-plus"></i>
            Crear Cuenta
          </button>

          <!-- Botones Sociales -->
          <div class="auth-social-buttons">
            <div class="auth-social-divider">
              <span>O regístrate con</span>
            </div>
            
            <button type="button" class="auth-social-btn google" onclick="signInWithGoogle()">
              <i class="fab fa-google"></i>
              Google
            </button>
            
            <button type="button" class="auth-social-btn apple" onclick="signInWithApple()">
              <i class="fab fa-apple"></i>
              Apple
            </button>
          </div>

          <!-- Enlaces adicionales -->
          <div class="auth-form-links">
            <p>
              ¿Ya tienes cuenta? 
              <a href="#" class="auth-form-link" onclick="switchAuthTab('login')">
                Inicia sesión aquí
              </a>
            </p>
          </div>
        </form>
      </div>
    </div>

        <!-- Footer -->
        <footer class="footer footer-peace">
                <div class="footer-content">
                    <!-- Brand Section -->
                    <div class="footer-brand">
                        <div class="footer-logo">SENSUS</div>
                        <p class="footer-description">
                            App de apoyo emocional respaldada por la ciencia. Tu salud mental merece respeto — y nosotros también lo tenemos.
                        </p>
                    </div>

                    <!-- Navigation Section -->
                    <div class="footer-navigation">
                        <div class="footer-section">
                            <h3 class="footer-section-title">Navegación</h3>
                            <ul class="footer-links">
                                <li><a href="/"><i class="fas fa-home"></i> Inicio</a></li>
                                <li><a href="/evaluacion"><i class="fas fa-clipboard-check"></i> Evaluación</a></li>
                                <li><a href="/diario"><i class="fas fa-book-open"></i> Diario</a></li>
                                <li><a href="/ansiedad"><i class="fas fa-heart"></i> Síntomas</a></li>
                            </ul>
                        </div>

                        <div class="footer-section">
                            <h3 class="footer-section-title">Recursos</h3>
                            <ul class="footer-links">
                                <li><a href="/planes"><i class="fas fa-star"></i> Planes</a></li>
                                <li><a href="/equipo"><i class="fas fa-users"></i> Equipo</a></li>
                                <li><a href="/contacto"><i class="fas fa-envelope"></i> Contacto</a></li>
                                <li><a href="/test"><i class="fas fa-clipboard-check"></i> Test</a></li>
                            </ul>
                        </div>

                        <div class="footer-section">
                            <h3 class="footer-section-title">Legal</h3>
                            <ul class="footer-links">
                                <li><a href="/politica-privacidad"><i class="fas fa-shield-alt"></i> Política de Privacidad</a></li>
                                <li><a href="/terminos-uso"><i class="fas fa-file-contract"></i> Términos de Uso</a></li>
                                <li><a href="/contacto"><i class="fas fa-envelope"></i> Contacto</a></li>
                                <li><a href="/equipo"><i class="fas fa-users"></i> Equipo</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Social Media Section -->
                    <div class="footer-social">
                        <a href="#" class="social-link" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>

                    <!-- Certifications Section -->
                    <div class="footer-certifications">
                        <div class="certification-badge" data-certification="GDPR" title="GDPR Compliant">
                            <i class="fas fa-shield-alt"></i>
                            <span>GDPR</span>
                        </div>
                        <div class="certification-badge" data-certification="HIPAA" title="HIPAA Compliant">
                            <i class="fas fa-lock"></i>
                            <span>HIPAA</span>
                        </div>
                        <div class="certification-badge" data-certification="ISO" title="ISO 27001 Certified">
                            <i class="fas fa-certificate"></i>
                            <span>ISO 27001</span>
                        </div>
                    </div>

                    <!-- Legal Section -->
                    <div class="footer-legal">
                        <div class="footer-legal-content">
                            <p class="footer-copyright">
                                SENSUS © 2025. App de apoyo emocional respaldada por la ciencia.
                            </p>
                            <div class="footer-legal-links">
                                <a href="/politica-privacidad">Política de Privacidad</a>
                                <a href="/terminos-uso">Términos de Uso</a>
                                <a href="/cookies">Política de Cookies</a>
                                <a href="/contacto">Contacto</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

            <!-- Botón Scroll to Top -->
            <button class="scroll-to-top" aria-label="Volver arriba">
                <i class="fas fa-arrow-up"></i>
            </button>


    <!-- Scripts simplificados -->
    <script src="/src/js/app.js"></script>

    <!-- Script de Funcionalidades Básicas -->
    <script is:inline>
      // ===== SISTEMA DE MENÚ MÓVIL =====
      document.addEventListener('DOMContentLoaded', function() {
        console.log('Script de menú móvil cargado');
        
        const menuToggle = document.querySelector('.menu-toggle');
        const menuOverlay = document.querySelector('.menu-overlay');
        const menuBackdrop = document.querySelector('.menu-backdrop');
        
        console.log('Elementos encontrados:', {
          menuToggle: !!menuToggle,
          menuOverlay: !!menuOverlay,
          menuBackdrop: !!menuBackdrop
        });
        
        if (menuToggle && menuOverlay) {
          // Función para abrir menú
          function openMenu() {
            console.log('Abriendo menú');
            menuToggle.classList.add('active');
            menuOverlay.classList.add('active');
            if (menuBackdrop) menuBackdrop.classList.add('active');
            document.body.style.overflow = 'hidden';
          }
          
          // Función para cerrar menú
          function closeMenu() {
            console.log('Cerrando menú');
            menuToggle.classList.remove('active');
            menuOverlay.classList.remove('active');
            if (menuBackdrop) menuBackdrop.classList.remove('active');
            document.body.style.overflow = '';
          }
          
          // Event listener principal del botón hamburguesa
          menuToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Botón hamburguesa clickeado');
            
            if (menuOverlay.classList.contains('active')) {
              closeMenu();
            } else {
              openMenu();
            }
          });
          
          // Cerrar menú al hacer clic en backdrop
          if (menuBackdrop) {
            menuBackdrop.addEventListener('click', function(e) {
              e.preventDefault();
              closeMenu();
            });
          }
          
          // Cerrar menú al hacer clic en enlaces
          const mobileNavItems = menuOverlay.querySelectorAll('a');
          console.log('Enlaces del menú móvil encontrados:', mobileNavItems.length);
          
          mobileNavItems.forEach((link, index) => {
            link.addEventListener('click', function(e) {
              const href = this.getAttribute('href');
              console.log(`Enlace ${index} clickeado:`, href);
              
              // Verificar que el enlace no sea un enlace externo o especial
              if (href && !href.startsWith('#') && !href.startsWith('mailto:') && !href.startsWith('tel:')) {
                // Cerrar menú antes de navegar
                closeMenu();
                // Pequeña demora para permitir que la animación se complete
                setTimeout(() => {
                  window.location.href = href;
                }, 150);
              } else {
                closeMenu();
              }
            });
          });
          
          // Cerrar menú con Escape
          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && menuOverlay.classList.contains('active')) {
              closeMenu();
            }
          });
          
          // Cerrar menú al redimensionar
          window.addEventListener('resize', function() {
            if (window.innerWidth > 767) {
              closeMenu();
            }
          });
          
          console.log('Event listeners del menú móvil configurados');
        } else {
          console.error('No se encontraron los elementos del menú móvil');
        }
        
        // ===== SISTEMA DE TEMAS =====
        // El sistema de temas ahora se maneja automáticamente por el componente ThemeToggle
        // Solo mantenemos la funcionalidad básica para compatibilidad
        
        // Escuchar cambios de tema desde el componente
        window.addEventListener('themechange', (event) => {
          console.log('Tema cambiado:', event.detail.theme);
          
          // Actualizar meta theme-color
          const themeColor = event.detail.theme === 'dark' ? '#1f2937' : '#2563eb';
          const metaThemeColor = document.querySelector('meta[name="theme-color"]');
          if (metaThemeColor) {
            metaThemeColor.setAttribute('content', themeColor);
          }
          
          // Actualizar meta msapplication-TileColor
          const metaTileColor = document.querySelector('meta[name="msapplication-TileColor"]');
          if (metaTileColor) {
            metaTileColor.setAttribute('content', themeColor);
          }
        });
        
        // ===== NAVEGACIÓN DEL FOOTER =====
        const footerLinks = document.querySelectorAll('.footer-links a');
        footerLinks.forEach(link => {
          link.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            if (href && !href.startsWith('#') && !href.startsWith('mailto:') && !href.startsWith('tel:') && !href.startsWith('http')) {
              e.preventDefault();
              // Navegar a la página
              window.location.href = href;
            }
          });
        });
        
        // ===== BOTÓN SCROLL TO TOP =====
        const scrollToTopBtn = document.querySelector('.scroll-to-top');
        
        if (scrollToTopBtn) {
          // Mostrar/ocultar botón según scroll
          window.addEventListener('scroll', function() {
            if (window.scrollY > 300) {
              scrollToTopBtn.classList.add('visible');
            } else {
              scrollToTopBtn.classList.remove('visible');
            }
          });
          
          // Funcionalidad del botón
          scrollToTopBtn.addEventListener('click', function() {
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          });
        }
      });
      
      // ===== SCRIPT DE PRUEBA ADICIONAL =====
      // Ejecutar después de un pequeño delay para asegurar que todo esté cargado
      setTimeout(function() {
        console.log('Ejecutando script de prueba del menú móvil');
        
        const menuToggle = document.querySelector('.menu-toggle');
        const menuOverlay = document.querySelector('.menu-overlay');
        
        if (menuToggle) {
          console.log('Botón hamburguesa encontrado, añadiendo event listener adicional');
          
          // Añadir un event listener adicional como respaldo
          menuToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Event listener adicional activado');
            
            if (menuOverlay) {
              if (menuOverlay.classList.contains('active')) {
                menuOverlay.classList.remove('active');
                menuToggle.classList.remove('active');
                document.body.style.overflow = '';
                console.log('Menú cerrado');
              } else {
                menuOverlay.classList.add('active');
                menuToggle.classList.add('active');
                document.body.style.overflow = 'hidden';
                console.log('Menú abierto');
              }
            }
          });
        } else {
          console.error('Botón hamburguesa no encontrado en el script de prueba');
        }
      }, 1000);
    </script>

    <!-- Script del Modal de Autenticación -->
    <script is:inline>
      // Funciones del modal de autenticación
      function openAuthModal(tab = 'login') {
        const modal = document.getElementById('auth-modal');
        if (modal) {
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
          switchAuthTab(tab);
        }
      }

      function closeAuthModal() {
        const modal = document.getElementById('auth-modal');
        if (modal) {
          modal.classList.remove('active');
          document.body.style.overflow = '';
          // Limpiar formularios
          clearAuthForms();
        }
      }

      function switchAuthTab(tab) {
        console.log('Cambiando a tab:', tab);
        
        // Actualizar tabs
        const tabs = document.querySelectorAll('.auth-tab');
        tabs.forEach(t => {
          t.classList.remove('active');
          console.log('Tab removido:', t.textContent.trim());
        });
        
        // Encontrar el tab correcto
        const activeTab = Array.from(tabs).find(t => 
          t.textContent.trim().toLowerCase().includes(tab === 'login' ? 'iniciar' : 'registrarse')
        );
        
        if (activeTab) {
          activeTab.classList.add('active');
          console.log('Tab activado:', activeTab.textContent.trim());
        }
        
        // Actualizar formularios
        const forms = document.querySelectorAll('.auth-form');
        forms.forEach(f => {
          f.classList.remove('active');
          console.log('Formulario removido:', f.id);
        });
        
        const activeForm = document.getElementById(`${tab}-form`);
        if (activeForm) {
          activeForm.classList.add('active');
          console.log('Formulario activado:', activeForm.id);
        } else {
          console.error('No se encontró el formulario:', `${tab}-form`);
        }
      }

      function clearAuthForms() {
        const forms = document.querySelectorAll('.auth-form');
        forms.forEach(form => {
          form.reset();
          // Limpiar mensajes de error
          const messages = form.querySelectorAll('.auth-form-message');
          messages.forEach(msg => msg.remove());
          // Limpiar clases de error
          const inputs = form.querySelectorAll('.auth-form-input');
          inputs.forEach(input => input.classList.remove('error'));
        });
      }

      function showAuthMessage(form, message, type = 'error') {
        const messageDiv = document.createElement('div');
        messageDiv.className = `auth-form-message ${type}`;
        
        const icon = type === 'error' ? 'exclamation-circle' : 
                     type === 'success' ? 'check-circle' : 'info-circle';
        
        messageDiv.innerHTML = `
          <i class="fas fa-${icon}"></i>
          ${message}
        `;
        
        form.insertBefore(messageDiv, form.firstChild);
        
        // Remover mensaje después de 5 segundos
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.remove();
          }
        }, 5000);
      }

      function showAuthLoading(form, show = true) {
        const submitBtn = form.querySelector('.auth-submit');
        if (submitBtn) {
          if (show) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
              <div class="auth-form-loading">
                <div class="spinner"></div>
                Procesando...
              </div>
            `;
          } else {
            submitBtn.disabled = false;
            // Restaurar texto original según el formulario
            if (form.id === 'login-form') {
              submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Iniciar Sesión';
            } else if (form.id === 'register-form') {
              submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> Crear Cuenta';
            }
          }
        }
      }

      // Cerrar modal al hacer clic fuera
      document.addEventListener('click', function(event) {
        const modal = document.getElementById('auth-modal');
        if (modal && event.target === modal) {
          closeAuthModal();
        }
      });

      // Cerrar modal con Escape
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          const modal = document.getElementById('auth-modal');
          if (modal && modal.classList.contains('active')) {
            closeAuthModal();
          }
        }
      });

      // Conectar botones de autenticación
      document.addEventListener('DOMContentLoaded', function() {
        // Botones del header
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        
        if (loginBtn) {
          loginBtn.addEventListener('click', function() {
            openAuthModal('login');
          });
        }
        
        if (registerBtn) {
          registerBtn.addEventListener('click', function() {
            openAuthModal('register');
          });
        }

        // Botones del menú móvil
        const mobileLoginBtn = document.getElementById('mobile-login-btn');
        const mobileRegisterBtn = document.getElementById('mobile-register-btn');
        
        if (mobileLoginBtn) {
          mobileLoginBtn.addEventListener('click', function() {
            openAuthModal('login');
            // Cerrar menú móvil
            const menuOverlay = document.querySelector('.menu-overlay');
            if (menuOverlay) {
              menuOverlay.classList.remove('active');
            }
          });
        }
        
        if (mobileRegisterBtn) {
          mobileRegisterBtn.addEventListener('click', function() {
            openAuthModal('register');
            // Cerrar menú móvil
            const menuOverlay = document.querySelector('.menu-overlay');
            if (menuOverlay) {
              menuOverlay.classList.remove('active');
            }
          });
        }
      });

      // Exportar funciones globalmente
      window.openAuthModal = openAuthModal;
      window.closeAuthModal = closeAuthModal;
      window.switchAuthTab = switchAuthTab;
      window.showAuthMessage = showAuthMessage;
      window.showAuthLoading = showAuthLoading;
    </script>

    <!-- Service Worker Registration -->
    <script is:inline>
      // Registrar Service Worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          try {
            const registration = await navigator.serviceWorker.register('/sw.js');
            console.log('Service Worker registrado exitosamente:', registration.scope);
            
            // Verificar actualizaciones
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // Nueva versión disponible
                    console.log('Nueva versión de la PWA disponible');
                    // Aquí podrías mostrar una notificación al usuario
                  }
                });
              }
            });
            
          } catch (error) {
            console.error('Error al registrar Service Worker:', error);
          }
        });
      }
    </script>

    <!-- Theme Manager -->
    <script src="/src/utils/themeManager.js"></script>
</body>
</html>
