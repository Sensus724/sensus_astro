---
export interface Props {
  title: string
  description?: string
  keywords?: string
  pageStylesheets?: string[]
  themeColor?: string
  activeNav?: string
}

const {
  title,
  description = "Tu compañero inteligente para la calma. Test GAD-7 gratuito, diario emocional encriptado y recursos profesionales. Validado por más de 127,000 personas en estudios clínicos.",
  keywords = "ansiedad, test ansiedad, diario emocional, salud mental, app ansiedad, test GAD-7, control ansiedad, bienestar mental, terapia online, mindfulness",
  pageStylesheets = [],
  themeColor = "#2563EB",
  activeNav = ""
} = Astro.props
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    
    <!-- CSS Principal Completo -->
    <style is:global>
        @import "/src/styles/main-complete.css";
    </style>
    
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Meta tags -->
    <meta name="description" content={description}>
    <meta name="keywords" content={keywords}>
    <meta name="author" content="Sensus Team">
    
    <!-- Favicon -->
    <link rel="icon" href="/assets/images/Logo.jpeg" type="image/jpeg">
    <link rel="apple-touch-icon" href="/assets/images/Logo.jpeg">
    <meta name="theme-color" content={themeColor}>
</head>
<body>
    <!-- Animación de carga -->
    <div class="loading-heart">
        <i class="fas fa-heart"></i>
    </div>
    
        <!-- Header -->
        <header class="header header-peace">
        <div class="header-container">
            <!-- Logo y menú hamburguesa juntos -->
            <div class="logo-nav-container">
                <div class="logo-placeholder">
                    <i class="fas fa-brain"></i>
                    <span>SENSUS</span>
                </div>
                <button class="menu-toggle" aria-label="Abrir menú">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
            
                <!-- Navegación desktop (oculta en móvil) -->
                <nav class="main-nav nav-peace">
                <ul class="nav-links">
                    <li><a href="/" class={activeNav === "inicio" ? "active" : ""}>
                        <i class="fas fa-home" aria-hidden="true"></i>
                        Inicio
                    </a></li>
                    <li><a href="/evaluacion" class={activeNav === "evaluacion" ? "active" : ""}>
                        <i class="fas fa-clipboard-check" aria-hidden="true"></i>
                        Evaluación
                    </a></li>
                    <li><a href="/diario" class={activeNav === "diario" ? "active" : ""}>
                        <i class="fas fa-book-open" aria-hidden="true"></i>
                        Diario
                    </a></li>
                    <li><a href="/ansiedad" class={activeNav === "ansiedad" ? "active" : ""}>
                        <i class="fas fa-heart" aria-hidden="true"></i>
                        Síntomas
                    </a></li>
                    <li><a href="/planes" class={activeNav === "planes" ? "active" : ""}>
                        <i class="fas fa-star" aria-hidden="true"></i>
                        Planes
                    </a></li>
                    <li><a href="/equipo" class={activeNav === "equipo" ? "active" : ""}>
                        <i class="fas fa-users" aria-hidden="true"></i>
                        Equipo
                    </a></li>
                    <li><a href="/contacto" class={activeNav === "contacto" ? "active" : ""}>
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                        Contacto
                    </a></li>
                </ul>
            </nav>
            
                    <!-- Botones de autenticación y toggle de tema -->
                    <div class="auth-buttons">
                        <button class="theme-toggle" aria-label="Cambiar tema" aria-pressed="false">
                            <i class="fas fa-sun toggle-icon sun"></i>
                            <i class="fas fa-moon toggle-icon moon"></i>
                        </button>
                        <button class="btn-cta btn-outline" id="login-btn">Iniciar sesión</button>
                        <button class="btn-cta" id="register-btn">Registrarse</button>
                    </div>
        </div>
    </header>
    
    <!-- Menu Overlay -->
    <div class="menu-backdrop"></div>
    <div class="menu-overlay">
        <div class="menu-header">
            <h3>Menú</h3>
        </div>
        <ul class="nav-links">
            <li><a href="/" class={activeNav === "inicio" ? "active" : ""}>
                <i class="fas fa-home" aria-hidden="true"></i>
                Inicio
            </a></li>
            <li><a href="/evaluacion" class={activeNav === "evaluacion" ? "active" : ""}>
                <i class="fas fa-clipboard-check" aria-hidden="true"></i>
                Evaluación
            </a></li>
            <li><a href="/diario" class={activeNav === "diario" ? "active" : ""}>
                <i class="fas fa-book-open" aria-hidden="true"></i>
                Diario
            </a></li>
            <li><a href="/ansiedad" class={activeNav === "ansiedad" ? "active" : ""}>
                <i class="fas fa-heart" aria-hidden="true"></i>
                Síntomas
            </a></li>
            <li><a href="/planes" class={activeNav === "planes" ? "active" : ""}>
                <i class="fas fa-star" aria-hidden="true"></i>
                Planes
            </a></li>
            <li><a href="/equipo" class={activeNav === "equipo" ? "active" : ""}>
                <i class="fas fa-users" aria-hidden="true"></i>
                Equipo
            </a></li>
            <li><a href="/contacto" class={activeNav === "contacto" ? "active" : ""}>
                <i class="fas fa-envelope" aria-hidden="true"></i>
                Contacto
            </a></li>
        </ul>
        
                <!-- Botones de autenticación en el menú móvil -->
                <div class="menu-auth-buttons">
                    <div class="mobile-theme-toggle">
                        <span class="theme-label">Tema:</span>
                        <button class="theme-toggle mobile" aria-label="Cambiar tema" aria-pressed="false">
                            <i class="fas fa-sun toggle-icon sun"></i>
                            <i class="fas fa-moon toggle-icon moon"></i>
                        </button>
                    </div>
                    <button class="btn-cta btn-outline" id="mobile-login-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        Iniciar sesión
                    </button>
                    <button class="btn-cta" id="mobile-register-btn">
                        <i class="fas fa-user-plus"></i>
                        Registrarse
                    </button>
                </div>
    </div>

    <main>
        <slot />
    </main>

    <!-- Modal de Autenticación -->
    <div id="auth-modal" class="auth-modal">
      <div class="auth-modal-content">
        <!-- Header del Modal -->
        <div class="auth-modal-header">
          <button class="auth-modal-close" onclick="closeAuthModal()">
            <i class="fas fa-times"></i>
          </button>
          
          <div class="auth-modal-logo">
            <i class="fas fa-heart"></i>
          </div>
          
          <h2 class="auth-modal-title">Bienvenido a Sensus</h2>
          <p class="auth-modal-subtitle">Tu compañero para el bienestar mental</p>
        </div>

        <!-- Tabs de Autenticación -->
        <div class="auth-tabs">
          <button class="auth-tab active" onclick="switchAuthTab('login')">
            Iniciar Sesión
          </button>
          <button class="auth-tab" onclick="switchAuthTab('register')">
            Registrarse
          </button>
        </div>

        <!-- Formulario de Inicio de Sesión -->
        <form id="login-form" class="auth-form active">
          <div class="auth-form-group">
            <label for="login-email" class="auth-form-label required">Correo electrónico</label>
            <input 
              type="email" 
              id="login-email" 
              class="auth-form-input" 
              placeholder="tu@email.com"
              required
            >
          </div>

          <div class="auth-form-group">
            <label for="login-password" class="auth-form-label required">Contraseña</label>
            <input 
              type="password" 
              id="login-password" 
              class="auth-form-input" 
              placeholder="Tu contraseña"
              required
            >
          </div>

          <div class="auth-form-checkbox-group">
            <input type="checkbox" id="remember-me" class="auth-form-checkbox">
            <label for="remember-me" class="auth-form-checkbox-label">
              Recordarme
            </label>
          </div>

          <button type="submit" class="auth-form-submit auth-submit">
            <i class="fas fa-sign-in-alt"></i>
            Iniciar Sesión
          </button>

          <!-- Botones Sociales -->
          <div class="auth-social-buttons">
            <div class="auth-social-divider">
              <span>O continúa con</span>
            </div>
            
            <button type="button" class="auth-social-btn google" onclick="signInWithGoogle()">
              <i class="fab fa-google"></i>
              Google
            </button>
            
            <button type="button" class="auth-social-btn apple" onclick="signInWithApple()">
              <i class="fab fa-apple"></i>
              Apple
            </button>
          </div>

          <!-- Enlaces adicionales -->
          <div class="auth-form-links">
            <a href="#" class="auth-form-link forgot-password" onclick="showPasswordResetModal()">
              ¿Olvidaste tu contraseña?
            </a>
            <p>
              ¿No tienes cuenta? 
              <a href="#" class="auth-form-link" onclick="switchAuthTab('register')">
                Regístrate aquí
              </a>
            </p>
          </div>
        </form>

        <!-- Formulario de Registro -->
        <form id="register-form" class="auth-form">
          <div class="auth-form-group double">
            <div>
              <label for="register-first-name" class="auth-form-label required">Nombre</label>
              <input 
                type="text" 
                id="register-first-name" 
                class="auth-form-input" 
                placeholder="Tu nombre"
                required
              >
            </div>
            <div>
              <label for="register-last-name" class="auth-form-label required">Apellido</label>
              <input 
                type="text" 
                id="register-last-name" 
                class="auth-form-input" 
                placeholder="Tu apellido"
                required
              >
            </div>
          </div>

          <div class="auth-form-group">
            <label for="register-email" class="auth-form-label required">Correo electrónico</label>
            <input 
              type="email" 
              id="register-email" 
              class="auth-form-input" 
              placeholder="tu@email.com"
              required
            >
          </div>

          <div class="auth-form-group">
            <label for="register-birth-date" class="auth-form-label required">Fecha de nacimiento</label>
            <input 
              type="date" 
              id="register-birth-date" 
              class="auth-form-input" 
              required
            >
          </div>

          <div class="auth-form-group">
            <label for="register-password" class="auth-form-label required">Contraseña</label>
            <input 
              type="password" 
              id="register-password" 
              class="auth-form-input" 
              placeholder="Mínimo 8 caracteres"
              required
            >
          </div>

          <div class="auth-form-group">
            <label for="register-confirm-password" class="auth-form-label required">Confirmar contraseña</label>
            <input 
              type="password" 
              id="register-confirm-password" 
              class="auth-form-input" 
              placeholder="Repite tu contraseña"
              required
            >
          </div>

          <div class="auth-form-checkbox-group">
            <input type="checkbox" id="accept-terms" class="auth-form-checkbox" required>
            <label for="accept-terms" class="auth-form-checkbox-label">
              Acepto los <a href="/terminos-uso" class="auth-form-link">términos y condiciones</a>
            </label>
          </div>

          <div class="auth-form-checkbox-group">
            <input type="checkbox" id="newsletter" class="auth-form-checkbox">
            <label for="newsletter" class="auth-form-checkbox-label">
              Quiero recibir consejos de bienestar por email
            </label>
          </div>

          <button type="submit" class="auth-form-submit auth-submit">
            <i class="fas fa-user-plus"></i>
            Crear Cuenta
          </button>

          <!-- Botones Sociales -->
          <div class="auth-social-buttons">
            <div class="auth-social-divider">
              <span>O regístrate con</span>
            </div>
            
            <button type="button" class="auth-social-btn google" onclick="signInWithGoogle()">
              <i class="fab fa-google"></i>
              Google
            </button>
            
            <button type="button" class="auth-social-btn apple" onclick="signInWithApple()">
              <i class="fab fa-apple"></i>
              Apple
            </button>
          </div>

          <!-- Enlaces adicionales -->
          <div class="auth-form-links">
            <p>
              ¿Ya tienes cuenta? 
              <a href="#" class="auth-form-link" onclick="switchAuthTab('login')">
                Inicia sesión aquí
              </a>
            </p>
          </div>
        </form>
      </div>
    </div>

        <!-- Footer -->
        <footer class="footer footer-peace">
                <div class="footer-content">
                    <!-- Brand Section -->
                    <div class="footer-brand">
                        <div class="footer-logo">SENSUS</div>
                        <p class="footer-description">
                            App de apoyo emocional respaldada por la ciencia. Tu salud mental merece respeto — y nosotros también lo tenemos.
                        </p>
                    </div>

                    <!-- Navigation Section -->
                    <div class="footer-navigation">
                        <div class="footer-section">
                            <h3 class="footer-section-title">Navegación</h3>
                            <ul class="footer-links">
                                <li><a href="/"><i class="fas fa-home"></i> Inicio</a></li>
                                <li><a href="/evaluacion"><i class="fas fa-clipboard-check"></i> Evaluación</a></li>
                                <li><a href="/diario"><i class="fas fa-book-open"></i> Diario</a></li>
                                <li><a href="/ansiedad"><i class="fas fa-heart"></i> Síntomas</a></li>
                            </ul>
                        </div>

                        <div class="footer-section">
                            <h3 class="footer-section-title">Recursos</h3>
                            <ul class="footer-links">
                                <li><a href="/planes"><i class="fas fa-star"></i> Planes</a></li>
                                <li><a href="/equipo"><i class="fas fa-users"></i> Equipo</a></li>
                                <li><a href="/contacto"><i class="fas fa-envelope"></i> Contacto</a></li>
                                <li><a href="/blog"><i class="fas fa-blog"></i> Blog</a></li>
                            </ul>
                        </div>

                        <div class="footer-section">
                            <h3 class="footer-section-title">Soporte</h3>
                            <ul class="footer-links">
                                <li><a href="/ayuda"><i class="fas fa-question-circle"></i> Ayuda</a></li>
                                <li><a href="/faq"><i class="fas fa-comments"></i> FAQ</a></li>
                                <li><a href="/comunidad"><i class="fas fa-users"></i> Comunidad</a></li>
                                <li><a href="/reportar"><i class="fas fa-flag"></i> Reportar</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Social Media Section -->
                    <div class="footer-social">
                        <a href="#" class="social-link" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>

                    <!-- Certifications Section -->
                    <div class="footer-certifications">
                        <div class="certification-badge" data-certification="GDPR" title="GDPR Compliant">
                            <i class="fas fa-shield-alt"></i>
                            <span>GDPR</span>
                        </div>
                        <div class="certification-badge" data-certification="HIPAA" title="HIPAA Compliant">
                            <i class="fas fa-lock"></i>
                            <span>HIPAA</span>
                        </div>
                        <div class="certification-badge" data-certification="ISO" title="ISO 27001 Certified">
                            <i class="fas fa-certificate"></i>
                            <span>ISO 27001</span>
                        </div>
                    </div>

                    <!-- Legal Section -->
                    <div class="footer-legal">
                        <div class="footer-legal-content">
                            <p class="footer-copyright">
                                SENSUS © 2025. App de apoyo emocional respaldada por la ciencia.
                            </p>
                            <div class="footer-legal-links">
                                <a href="/politica-privacidad">Política de Privacidad</a>
                                <a href="/terminos-uso">Términos de Uso</a>
                                <a href="/cookies">Política de Cookies</a>
                                <a href="/contacto">Contacto</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

            <!-- Botón Scroll to Top -->
            <button class="scroll-to-top" aria-label="Volver arriba">
                <i class="fas fa-arrow-up"></i>
            </button>


        <!-- Scripts - Sistema de carga optimizado -->
        <script is:inline src="/js/load-existing-files.js"></script>
    
    <!-- Firebase - Sistema Completo -->
    <script is:inline src="/js/firebase-init.js"></script>
    <script is:inline src="/js/modules/firebase-services.js"></script>
    <script is:inline src="/js/modules/auth-enhanced.js"></script>

    <!-- Script del Modal de Autenticación -->
    <script is:inline>
      // Funciones del modal de autenticación
      function openAuthModal(tab = 'login') {
        const modal = document.getElementById('auth-modal');
        if (modal) {
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
          switchAuthTab(tab);
        }
      }

      function closeAuthModal() {
        const modal = document.getElementById('auth-modal');
        if (modal) {
          modal.classList.remove('active');
          document.body.style.overflow = '';
          // Limpiar formularios
          clearAuthForms();
        }
      }

      function switchAuthTab(tab) {
        console.log('Cambiando a tab:', tab);
        
        // Actualizar tabs
        const tabs = document.querySelectorAll('.auth-tab');
        tabs.forEach(t => {
          t.classList.remove('active');
          console.log('Tab removido:', t.textContent.trim());
        });
        
        // Encontrar el tab correcto
        const activeTab = Array.from(tabs).find(t => 
          t.textContent.trim().toLowerCase().includes(tab === 'login' ? 'iniciar' : 'registrarse')
        );
        
        if (activeTab) {
          activeTab.classList.add('active');
          console.log('Tab activado:', activeTab.textContent.trim());
        }
        
        // Actualizar formularios
        const forms = document.querySelectorAll('.auth-form');
        forms.forEach(f => {
          f.classList.remove('active');
          console.log('Formulario removido:', f.id);
        });
        
        const activeForm = document.getElementById(`${tab}-form`);
        if (activeForm) {
          activeForm.classList.add('active');
          console.log('Formulario activado:', activeForm.id);
        } else {
          console.error('No se encontró el formulario:', `${tab}-form`);
        }
      }

      function clearAuthForms() {
        const forms = document.querySelectorAll('.auth-form');
        forms.forEach(form => {
          form.reset();
          // Limpiar mensajes de error
          const messages = form.querySelectorAll('.auth-form-message');
          messages.forEach(msg => msg.remove());
          // Limpiar clases de error
          const inputs = form.querySelectorAll('.auth-form-input');
          inputs.forEach(input => input.classList.remove('error'));
        });
      }

      function showAuthMessage(form, message, type = 'error') {
        const messageDiv = document.createElement('div');
        messageDiv.className = `auth-form-message ${type}`;
        
        const icon = type === 'error' ? 'exclamation-circle' : 
                     type === 'success' ? 'check-circle' : 'info-circle';
        
        messageDiv.innerHTML = `
          <i class="fas fa-${icon}"></i>
          ${message}
        `;
        
        form.insertBefore(messageDiv, form.firstChild);
        
        // Remover mensaje después de 5 segundos
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.remove();
          }
        }, 5000);
      }

      function showAuthLoading(form, show = true) {
        const submitBtn = form.querySelector('.auth-submit');
        if (submitBtn) {
          if (show) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
              <div class="auth-form-loading">
                <div class="spinner"></div>
                Procesando...
              </div>
            `;
          } else {
            submitBtn.disabled = false;
            // Restaurar texto original según el formulario
            if (form.id === 'login-form') {
              submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Iniciar Sesión';
            } else if (form.id === 'register-form') {
              submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> Crear Cuenta';
            }
          }
        }
      }

      // Cerrar modal al hacer clic fuera
      document.addEventListener('click', function(event) {
        const modal = document.getElementById('auth-modal');
        if (modal && event.target === modal) {
          closeAuthModal();
        }
      });

      // Cerrar modal con Escape
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          const modal = document.getElementById('auth-modal');
          if (modal && modal.classList.contains('active')) {
            closeAuthModal();
          }
        }
      });

      // Conectar botones de autenticación
      document.addEventListener('DOMContentLoaded', function() {
        // Botones del header
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        
        if (loginBtn) {
          loginBtn.addEventListener('click', function() {
            openAuthModal('login');
          });
        }
        
        if (registerBtn) {
          registerBtn.addEventListener('click', function() {
            openAuthModal('register');
          });
        }

        // Botones del menú móvil
        const mobileLoginBtn = document.getElementById('mobile-login-btn');
        const mobileRegisterBtn = document.getElementById('mobile-register-btn');
        
        if (mobileLoginBtn) {
          mobileLoginBtn.addEventListener('click', function() {
            openAuthModal('login');
            // Cerrar menú móvil
            const menuOverlay = document.querySelector('.menu-overlay');
            if (menuOverlay) {
              menuOverlay.classList.remove('active');
            }
          });
        }
        
        if (mobileRegisterBtn) {
          mobileRegisterBtn.addEventListener('click', function() {
            openAuthModal('register');
            // Cerrar menú móvil
            const menuOverlay = document.querySelector('.menu-overlay');
            if (menuOverlay) {
              menuOverlay.classList.remove('active');
            }
          });
        }
      });

      // Exportar funciones globalmente
      window.openAuthModal = openAuthModal;
      window.closeAuthModal = closeAuthModal;
      window.switchAuthTab = switchAuthTab;
      window.showAuthMessage = showAuthMessage;
      window.showAuthLoading = showAuthLoading;
    </script>
</body>
</html>
